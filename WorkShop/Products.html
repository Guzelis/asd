<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="container">
      <form action="">
        <div class="row">
          <div class="col-4 mt-2">
            <label for="title">Pavadinimas</label>
            <input name="title" type="text" id="title" class="form-control" />
          </div>
          <div class="col-4 mt-2">
            <label for="price">Kaina</label>
            <input name="price" type="text" id="price" class="form-control" />
          </div>
          <div class="col-4 my-2">
            <label for="stock">Kiekis</label>
            <input name="stock" type="text" id="stock" class="form-control" />
          </div>
          <div class="col-4 mt-4">
            <label for="brand">Prekinis zenklas</label>
            <input name="brand" type="text" id="brand" class="form-control" />
          </div>
          <div class="col-4 mt-4">
            <label for="category">Klase</label>
            <select name="category" class="form-select" id="category">
              <option>smartphones</option>
              <option>laptops</option>
              <option>fragrances</option>
              <option>skincare</option>
              <option>groceries</option>
              <option>home-decoration</option>
            </select>
          </div>
          <div class="col-4">
            <button class="btn btn-primary mt-5" id="Submit">Submit</button>
          </div>
        </div>
      </form>

      <table class="table table-striped mt-5">
        <thead>
          <tr>
            <th>#</th>
            <th>Prekes pavadinimas</th>
            <th>Kaina</th>
            <th>Kiekis</th>
            <th>Prekinis zenklas</th>
            <th>Kategorija</th>
            <th>Veiksmai</th>
          </tr>
        </thead>
        <tbody id="dynamic-data"></tbody>
      </table>
    </div>
    <script src="products.js"></script>

    <script>
      currentProduct = undefined;
      let editMode = false;
      const dynamicDataElement = document.getElementById("dynamic-data");
      const titleInputElement = document.querySelector("#title");
      const priceInputElement = document.querySelector("#price");
      const stockInputElement = document.querySelector("#stock");
      const brandInputElement = document.querySelector("#brand");
      const categoryInputElement = document.querySelector("#category");
      const btn = document.getElementById("Submit");

      //Atvizdavimas turinio
      function getTableContents() {
        let dynamicHTML = ``;

        for (const product of products) {
          dynamicHTML += `<tr>
           <td>${product.id}</td>
           <td>${product.title}</td>
           <td>${product.price}</td>
           <td>${product.stock}</td>
           <td>${product.brand}</td>
           <td>${product.category}</td>
           <td><button class="btn  btn-danger" onclick="deleteProduct(${product.id})">Istrinti</button>
           <button class="btn btn-success" onclick="setEdit(${product.id})">Atnaujinti</button></td>
         </tr>`;
        }

        dynamicDataElement.innerHTML = dynamicHTML;
      }

      getTableContents();

      /// istrynimas
      const deleteProduct = (id) => {
        let elementIndex = products.findIndex((value) => value.id === id);
        products.splice(elementIndex, 1);
        getTableContents();
      };

      ///pridejimas
      const createNewRecord = (event) => {
        //prevencija nuo iprastinio elgesio
        event.preventDefault();

        const newProduct = {
          id: products[products.length - 1].id + 1, // pridejimas prie paskutinio
          title: titleInputElement.value,
          price: priceInputElement.value,
          stock: stockInputElement.value,
          brand: brandInputElement.value,
          category: categoryInputElement.value,
        };

        products.push(newProduct);
        getTableContents();
        reset();
      };
      btn.onclick = createNewRecord;

      /// Updeitinimas

      function setEdit(id) {
        let elementIndex = products.findIndex((value) => value.id === id);
        const product = products[elementIndex];
        titleInputElement.value = product.title;
        priceInputElement.value = product.price;
        stockInputElement.value = product.stock;
        brandInputElement.value = product.brand;
        categoryInputElement.value = product.category;

        editMode = true;
        currentProduct = elementIndex;
        btn.innerHTML = "Atnaujinti";
        btn.classList.add("btn-success");
        btn.classList.remove("btn-primary");
        btn.onclick = updateProduct;
      }

      function updateProduct(event) {
        event.preventDefault();
        products[currentProduct].title = titleInputElement.value;
        products[currentProduct].price = priceInputElement.value;
        products[currentProduct].stock = stockInputElement.value;
        products[currentProduct].brand = brandInputElement.value;
        products[currentProduct].category = categoryInputElement.value;

        getTableContents();

        btn.onclick = createNewRecord;
        btn.innerHTML = "Submit";
        btn.classList.add("btn-primary");
        btn.classList.remove("btn-success");
        editMode = false;
        currentProduct = undefined;
        reset();
      }

      function reset() {
        titleInputElement.value = "";
        priceInputElement.value = "";
        stockInputElement.value = "";
        brandInputElement.value = "";
        categoryInputElement.value = "";
      }
    </script>
  </body>
</html>
